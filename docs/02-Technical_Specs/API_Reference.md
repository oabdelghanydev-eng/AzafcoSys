# API Error Codes - ุฃููุงุฏ ุงูุฃุฎุทุงุก

## ๐ ูุธุฑุฉ ุนุงูุฉ

ูุฐุง ุงูููู ููุซู ุฌููุน ุฃููุงุฏ ุงูุฃุฎุทุงุก ุงููุณุชุฎุฏูุฉ ูู ุงูู API.

---

## ๐ข HTTP Status Codes

| Code | ุงููุนูู | ุงูุงุณุชุฎุฏุงู |
|------|--------|----------|
| `200` | OK | ูุฌุงุญ ุงูุนูููุฉ |
| `201` | Created | ุชู ุงูุฅูุดุงุก ุจูุฌุงุญ |
| `204` | No Content | ุชู ุงูุญุฐู/ุงูุฅูุบุงุก ุจูุฌุงุญ |
| `400` | Bad Request | ุจูุงูุงุช ุบูุฑ ุตุญูุญุฉ |
| `401` | Unauthorized | ุบูุฑ ููุณุฌู ุฏุฎูู |
| `403` | Forbidden | ุบูุฑ ูุตุฑุญ |
| `404` | Not Found | ุบูุฑ ููุฌูุฏ |
| `422` | Validation Error | ุฎุทุฃ ูู ุงูุจูุงูุงุช |
| `429` | Too Many Requests | ุชุฌุงูุฒ ุญุฏ ุงูุทูุจุงุช |
| `500` | Server Error | ุฎุทุฃ ูู ุงูุณูุฑูุฑ |

---

## ๐ ุฃููุงุฏ ุงูุฃุฎุทุงุก ุงููุฎุตุตุฉ

### ูููู ุงูุงุณุชุฌุงุจุฉ
```json
{
    "success": false,
    "error": {
        "code": "INV_001",
        "message": "ุฑุณุงูุฉ ุงูุฎุทุฃ ุจุงูุนุฑุจูุฉ",
        "message_en": "Error message in English",
        "details": {}
    }
}
```

---

## ๐ ุฃุฎุทุงุก ุงูููุงุชูุฑ (INV)

| ุงูููุฏ | ุงูุฑุณุงูุฉ | ุงูุณุจุจ |
|-------|---------|-------|
| `INV_001` | ูุง ูููู ุญุฐู ุงูููุงุชูุฑ | ุงูุญุฐู ููููุนุ ุงุณุชุฎุฏู ุงูุฅูุบุงุก |
| `INV_002` | ูุง ูููู ุชูููู ุงููููุฉ ุฃูู ูู ุงููุฏููุน | `new_total < paid_amount` |
| `INV_003` | ูุง ูููู ุฅุนุงุฏุฉ ุชูุนูู ูุงุชูุฑุฉ ููุบุงุฉ | ูุญุงููุฉ ุชุบููุฑ status ูู cancelled |
| `INV_004` | ุงููุงุชูุฑุฉ ุฎุงุฑุฌ ูุงูุฐุฉ ุงูุชุนุฏูู | ุชุฌุงูุฒ `edit_window_days` |
| `INV_005` | ุงููููุฉ ุงููุทููุจุฉ ุบูุฑ ูุชููุฑุฉ | FIFO check failed |
| `INV_006` | ุงููุงุชูุฑุฉ ูุฌุจ ุฃู ุชุญุชูู ุนูู ุจูุฏ ูุงุญุฏ ุนูู ุงูุฃูู | `items.length = 0` |

---

## ๐ฐ ุฃุฎุทุงุก ุงูุชุญุตููุงุช (COL)

| ุงูููุฏ | ุงูุฑุณุงูุฉ | ุงูุณุจุจ |
|-------|---------|-------|
| `COL_001` | ูุง ูููู ุญุฐู ุงูุชุญุตููุงุช | ุงูุญุฐู ููููุน |
| `COL_002` | ุงููุจูุบ ูุฌุจ ุฃู ูููู ุฃูุจุฑ ูู ุตูุฑ | `amount <= 0` |
| `COL_003` | ุงููุงุชูุฑุฉ ูุง ุชุฎุต ูุฐุง ุงูุนููู | Manual allocation error |
| `COL_004` | ุงูุชุญุตูู ุฎุงุฑุฌ ูุงูุฐุฉ ุงูุชุนุฏูู | ุชุฌุงูุฒ `edit_window_days` |

---

## ๐ฆ ุฃุฎุทุงุก ุงูุดุญูุงุช (SHP)

| ุงูููุฏ | ุงูุฑุณุงูุฉ | ุงูุณุจุจ |
|-------|---------|-------|
| `SHP_001` | ูุง ูููู ุญุฐู ุดุญูุฉ ููุง ููุงุชูุฑ ูุฑุชุจุทุฉ | FK constraint |
| `SHP_002` | ูุง ูููู ุชุนุฏูู ุดุญูุฉ ููุตูุงุฉ | `status = settled` |
| `SHP_003` | ุงูุดุญูุฉ ููุตูุงุฉ ุจุงููุนู | ูุญุงููุฉ settle ูุฑุชูู |
| `SHP_004` | ุงูุดุญูุฉ ุงูุชุงููุฉ ูุฌุจ ุฃู ุชููู ููุชูุญุฉ | Selected shipment not open |
| `SHP_005` | ูุง ูููู ุฅูุบุงุก ุงูุชุตููุฉ - ุงููููุฉ ุชู ุจูุนูุง | Unsettle safety check |

---

## ๐ ุฃุฎุทุงุก ุงููุตุงุฏูุฉ (AUTH)

| ุงูููุฏ | ุงูุฑุณุงูุฉ | ุงูุณุจุจ |
|-------|---------|-------|
| `AUTH_001` | ุบูุฑ ููุณุฌู ุฏุฎูู | Token missing/expired |
| `AUTH_002` | ุบูุฑ ูุตุฑุญ ุจูุฐู ุงูุนูููุฉ | No permission |
| `AUTH_003` | ุงูุญุณุงุจ ูููู | `is_locked = true` |
| `AUTH_004` | ูุดู ุชุณุฌูู ุงูุฏุฎูู | Invalid credentials |
| `AUTH_005` | ุชุฌุงูุฒ ุนุฏุฏ ุงููุญุงููุงุช ุงููุณููุญุฉ | Failed attempts limit |

---

## โ๏ธ ุฃุฎุทุงุก ุงููุธุงู (SYS)

| ุงูููุฏ | ุงูุฑุณุงูุฉ | ุงูุณุจุจ |
|-------|---------|-------|
| `SYS_001` | ุฎุทุฃ ูู ุงูุฎุงุฏู | Uncaught exception |
| `SYS_002` | ุชุฌุงูุฒ ุญุฏ ุงูุทูุจุงุช | Rate limit exceeded |
| `SYS_003` | ุงูุฎุฏูุฉ ุบูุฑ ูุชุงุญุฉ ูุคูุชุงู | Maintenance mode |

---

## ๐ Endpoints ุฅุถุงููุฉ (Additional)

### Health Check
| Method | Endpoint | ุงููุตู |
|--------|----------|-------|
| `GET` | `/api/health` | ูุญุต ุญุงูุฉ ุงูู API |

### Dashboard
| Method | Endpoint | ุงููุตู |
|--------|----------|-------|
| `GET` | `/api/dashboard` | ููุฎุต ููุญุฉ ุงูุชุญูู |
| `GET` | `/api/dashboard/activity` | ุขุฎุฑ ุงููุดุงุทุงุช |

### Treasury (ุงูุฎุฒูุฉ ูุงูุจูู)
| Method | Endpoint | ุงููุตู |
|--------|----------|-------|
| `GET` | `/api/cashbox` | ุฑุตูุฏ ุงูุฎุฒูุฉ |
| `GET` | `/api/cashbox/transactions` | ุญุฑูุงุช ุงูุฎุฒูุฉ |
| `POST` | `/api/cashbox/deposit` | ุฅูุฏุงุน ููุฎุฒูุฉ |
| `POST` | `/api/cashbox/withdraw` | ุณุญุจ ูู ุงูุฎุฒูุฉ |
| `GET` | `/api/bank` | ุฑุตูุฏ ุงูุจูู |
| `GET` | `/api/bank/transactions` | ุญุฑูุงุช ุงูุจูู |
| `POST` | `/api/bank/deposit` | ุฅูุฏุงุน ููุจูู |
| `POST` | `/api/bank/withdraw` | ุณุญุจ ูู ุงูุจูู |

### Accounts & Transfers
| Method | Endpoint | ุงููุตู |
|--------|----------|-------|
| `GET` | `/api/accounts` | ูุงุฆูุฉ ุงูุญุณุงุจุงุช |
| `GET` | `/api/accounts/summary` | ููุฎุต ุงูุฃุฑุตุฏุฉ |
| `GET/POST` | `/api/transfers` | ุงูุชุญูููุงุช |

### Inventory
| Method | Endpoint | ุงููุตู |
|--------|----------|-------|
| `GET` | `/api/shipments/stock` | ุงููุฎุฒูู ุงููุชุงุญ ููุจูุน |
| `GET` | `/api/permissions` | ูุงุฆูุฉ ุงูุตูุงุญูุงุช ุงููุชุงุญุฉ |

---

## ๐ Rate Limiting

| Endpoint | ุงูุญุฏ | ุงููุงูุฐุฉ |
|----------|------|---------|
| `/api/auth/*` | 10 requests | per minute |
| `/api/*` (authenticated) | 60 requests | per minute |
| `/api/reports/*` | 10 requests | per minute |

### Response Headers
```
X-RateLimit-Limit: 60
X-RateLimit-Remaining: 45
X-RateLimit-Reset: 1702425600
```

---

## ๐ Retry Logic

ููุฃุฎุทุงุก ุงููุงุจูุฉ ููุฅุนุงุฏุฉ:
```javascript
const retryableErrors = [429, 500, 502, 503, 504];

async function fetchWithRetry(url, options, maxRetries = 3) {
    for (let i = 0; i < maxRetries; i++) {
        try {
            const response = await fetch(url, options);
            if (!retryableErrors.includes(response.status)) {
                return response;
            }
            await delay(Math.pow(2, i) * 1000); // Exponential backoff
        } catch (error) {
            if (i === maxRetries - 1) throw error;
        }
    }
}
```

---

## ๐ Localization

ุงูุฃุฎุทุงุก ุชูุฑุฌุน ุจูุบุชูู:
```json
{
    "error": {
        "code": "INV_002",
        "message": "ูุง ูููู ุชูููู ุงููููุฉ ุฃูู ูู ุงููุฏููุน",
        "message_en": "Cannot reduce total below paid amount"
    }
}
```

ุงุณุชุฎุฏุงู ุงูู Header:
```
Accept-Language: ar  // ุงูุนุฑุจูุฉ
Accept-Language: en  // English
```
