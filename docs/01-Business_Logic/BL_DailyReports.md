# Daily Reports - Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠØ©

## ğŸ“‹ Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©

Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠØ© ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ **Ø¬Ù„Ø³Ø© Ø¹Ù…Ù„ ÙŠÙˆÙ…ÙŠØ©** - Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠÙØªØ­ Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙˆÙƒÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª ØªØ£Ø®Ø° Ù†ÙØ³ Ø§Ù„ØªØ§Ø±ÙŠØ® ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.

---

## ğŸ”„ Ø¬Ù„Ø³Ø© Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„ÙŠÙˆÙ…ÙŠØ© (Working Day Session)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    WORKING DAY SESSION                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  1ï¸âƒ£ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¹Ù…Ù„:                                            â”‚
â”‚     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                            â”‚
â”‚     Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠØ®ØªØ§Ø±: "ÙØªØ­ ÙŠÙˆÙ…ÙŠØ© 12 Ø¯ÙŠØ³Ù…Ø¨Ø±"                   â”‚
â”‚     â†’ Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ­ÙØ¸ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙÙŠ Ø§Ù„Ù€ Session                    â”‚
â”‚     â†’ Opening Balance = Ø¢Ø®Ø± Closing Balance                 â”‚
â”‚                                                              â”‚
â”‚  2ï¸âƒ£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¹Ù…Ù„:                                            â”‚
â”‚     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                            â”‚
â”‚     ÙØ§ØªÙˆØ±Ø© â† date = 12 (ØªÙ„Ù‚Ø§Ø¦ÙŠ)                              â”‚
â”‚     ØªØ­ØµÙŠÙ„ â† date = 12 (ØªÙ„Ù‚Ø§Ø¦ÙŠ)                               â”‚
â”‚     Ù…ØµØ±ÙˆÙ â† date = 12 (ØªÙ„Ù‚Ø§Ø¦ÙŠ)                               â”‚
â”‚     (Ø¨Ø¯ÙˆÙ† Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙÙŠ ÙƒÙ„ Ø¹Ù…Ù„ÙŠØ©)                        â”‚
â”‚                                                              â”‚
â”‚  3ï¸âƒ£ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¹Ù…Ù„:                                            â”‚
â”‚     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                            â”‚
â”‚     "Ø¥ØºÙ„Ø§Ù‚ ÙŠÙˆÙ…ÙŠØ© 12" Ø¨ØµÙ„Ø§Ø­ÙŠØ© daily.close                    â”‚
â”‚     â†’ Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª ÙˆØ§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø®ØªØ§Ù…ÙŠ                       â”‚
â”‚     â†’ status = 'closed'                                      â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“… Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„Ù…ØªØ§Ø­Ø© Ù„Ù„ÙØªØ­

### Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª

```php
// Settings Table
'backdated_days' => 2  // Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ø³Ù…ÙˆØ­ ÙØªØ­Ù‡Ø§ Ø¨Ø£Ø«Ø± Ø±Ø¬Ø¹ÙŠ
```

### Ø§Ù„Ù…Ù†Ø·Ù‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ğŸ“… Ø§Ù„ÙŠÙˆÙ…: 14 Ø¯ÙŠØ³Ù…Ø¨Ø± | Setting: backdated_days = 2         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚   Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø²Ù…Ù†ÙŠ: 12 â†’ 14 Ø¯ÙŠØ³Ù…Ø¨Ø±                             â”‚
â”‚                                                              â”‚
â”‚   Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„Ù…ØªØ§Ø­Ø© Ù„Ù„ÙØªØ­:                                   â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                  â”‚
â”‚   12 Dec: Ù…ØºÙ„Ù‚ âŒ â†’ ØºÙŠØ± Ù…ØªØ§Ø­                                â”‚
â”‚   13 Dec: Ù…ØºÙ„Ù‚ âŒ â†’ ØºÙŠØ± Ù…ØªØ§Ø­                                â”‚
â”‚   14 Dec: Ù…ÙØªÙˆØ­/Ø¬Ø¯ÙŠØ¯ âœ… â†’ Ù…ØªØ§Ø­                              â”‚
â”‚                                                              â”‚
â”‚   Ø§Ù„Ù†ØªÙŠØ¬Ø©: ÙŠÙ…ÙƒÙ† ÙØªØ­ ÙŠÙˆÙ…ÙŠØ© 14 Ø¯ÙŠØ³Ù…Ø¨Ø± ÙÙ‚Ø·                     â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> **Ù‚Ø§Ø¹Ø¯Ø©:** Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ù…ØºÙ„Ù‚ Ù„Ø§ ÙŠÙ…ÙƒÙ† ÙØªØ­Ù‡ Ø¥Ù„Ø§ Ø¨ØµÙ„Ø§Ø­ÙŠØ© `daily.reopen`

---

## ğŸ” Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª

| Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© | Ø§Ù„ÙˆØµÙ |
|----------|-------|
| `daily.close` | Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ÙŠÙˆÙ…ÙŠØ© |
| `daily.reopen` | Ø¥Ø¹Ø§Ø¯Ø© ÙØªØ­ ÙŠÙˆÙ…ÙŠØ© Ù…ØºÙ„Ù‚Ø© (Ù„Ù„ØªØµØ­ÙŠØ­Ø§Øª) |

---

## ğŸ“¦ Service Layer

### DailyReportService

```php
class DailyReportService
{
    /**
     * Get available dates for opening
     * Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„Ù…ØªØ§Ø­Ø© Ù„ÙØªØ­ ÙŠÙˆÙ…ÙŠØ©
     */
    public function getAvailableDates(): array
    {
        $backdatedDays = (int) Setting::getValue('backdated_days', 2);
        $startDate = today()->subDays($backdatedDays);
        $endDate = today();
        
        $dates = [];
        
        for ($date = clone $startDate; $date <= $endDate; $date->addDay()) {
            $report = DailyReport::where('date', $date->toDateString())->first();
            
            // Available if: no report OR report is open
            if (!$report || $report->status === 'open') {
                $dates[] = [
                    'date' => $date->toDateString(),
                    'status' => $report ? 'open' : 'new',
                ];
            }
        }
        
        return $dates;
    }
    
    /**
     * Open/Resume working day
     * ÙØªØ­ Ø¬Ù„Ø³Ø© Ø¹Ù…Ù„ ÙŠÙˆÙ…ÙŠØ©
     */
    public function openWorkingDay(string $date): DailyReport
    {
        // Validate date is available
        $this->validateDateAvailable($date);
        
        // Create or get existing report
        $report = DailyReport::firstOrCreate(
            ['date' => $date],
            [
                'cashbox_opening' => $this->getLastClosingBalance('cashbox'),
                'bank_opening' => $this->getLastClosingBalance('bank'),
                'status' => 'open',
            ]
        );
        
        // Store in session
        session(['working_date' => $date]);
        session(['working_report_id' => $report->id]);
        
        return $report;
    }
    
    /**
     * Get current working date
     * Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø§Ù„ÙŠ Ù„Ù„Ø¹Ù…Ù„
     */
    public function getWorkingDate(): ?string
    {
        return session('working_date');
    }
    
    /**
     * Close working day
     * Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©
     */
    public function closeWorkingDay(): void
    {
        $report = DailyReport::find(session('working_report_id'));
        
        if (!$report) {
            throw new BusinessException('DAY_002', 'Ù„Ø§ ØªÙˆØ¬Ø¯ ÙŠÙˆÙ…ÙŠØ© Ù…ÙØªÙˆØ­Ø©', 'No open daily report');
        }
        
        // Calculate closing balances from operations
        $report->update([
            'total_sales' => $this->calculateDayTotal($report->date, 'sales'),
            'total_collections_cash' => $this->calculateDayTotal($report->date, 'collections_cash'),
            'total_expenses_cash' => $this->calculateDayTotal($report->date, 'expenses_cash'),
            'cashbox_closing' => $this->calculateClosingBalance($report, 'cashbox'),
            'bank_closing' => $this->calculateClosingBalance($report, 'bank'),
            'status' => 'closed',
            'closed_at' => now(),
            'closed_by' => auth()->id(),
        ]);
        
        // Clear session
        session()->forget(['working_date', 'working_report_id']);
    }
}
```

---

## ğŸ”— Integration with Operations

### Ø¹Ù†Ø¯ Ø¥Ù†Ø´Ø§Ø¡ ÙØ§ØªÙˆØ±Ø©/ØªØ­ØµÙŠÙ„/Ù…ØµØ±ÙˆÙ

```php
// InvoiceController::store
public function store(Request $request)
{
    $workingDate = $this->dailyReportService->getWorkingDate();
    
    if (!$workingDate) {
        throw new BusinessException('DAY_003', 'ÙŠØ¬Ø¨ ÙØªØ­ ÙŠÙˆÙ…ÙŠØ© Ø£ÙˆÙ„Ø§Ù‹', 'Must open a daily report first');
    }
    
    $invoice = Invoice::create([
        'date' => $workingDate,  // â† ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù…Ù† Ø§Ù„Ù€ Session
        'customer_id' => $request->customer_id,
        ...
    ]);
}
```

---

## ğŸ“Š API Endpoints

| Method | Endpoint | Permission | Description |
|--------|----------|------------|-------------|
| GET | `/api/daily/available` | - | Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„Ù…ØªØ§Ø­Ø© Ù„Ù„ÙØªØ­ |
| POST | `/api/daily/open` | - | ÙØªØ­ Ø¬Ù„Ø³Ø© Ø¹Ù…Ù„ |
| GET | `/api/daily/current` | - | Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø§Ù„Ù…ÙØªÙˆØ­Ø© |
| POST | `/api/daily/close` | `daily.close` | Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ÙŠÙˆÙ…ÙŠØ© |
| POST | `/api/daily/{date}/reopen` | `daily.reopen` | Ø¥Ø¹Ø§Ø¯Ø© ÙØªØ­ |
| GET | `/api/daily/{date}` | - | ØªÙØ§ØµÙŠÙ„ ÙŠÙˆÙ…ÙŠØ© |

---

## âš ï¸ Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¹Ù…Ù„

| Rule ID | Ø§Ù„ÙˆØµÙ |
|---------|-------|
| BR-DAY-001 | ÙŠØ¬Ø¨ ÙØªØ­ ÙŠÙˆÙ…ÙŠØ© Ù‚Ø¨Ù„ Ø£ÙŠ Ø¹Ù…Ù„ÙŠØ© |
| BR-DAY-002 | ÙƒÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª ØªØ£Ø®Ø° ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ø§Ù„Ù…ÙØªÙˆØ­Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ |
| BR-DAY-003 | Opening Balance = Ø¢Ø®Ø± Closing Balance |
| BR-DAY-004 | Ù„Ø§ ÙŠÙ…ÙƒÙ† ÙØªØ­ ÙŠÙˆÙ…ÙŠØ© Ù…ØºÙ„Ù‚Ø© (Ø¥Ù„Ø§ Ø¨Ù€ daily.reopen) |
| BR-DAY-005 | Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„Ù…ØªØ§Ø­Ø© = Ø¶Ù…Ù† backdated_days + ØºÙŠØ± Ù…ØºÙ„Ù‚Ø© |
| BR-DAY-006 | Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ÙŠÙˆÙ…ÙŠØ© ÙŠØ­Ø³Ø¨ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ |

---

## ğŸ—„ï¸ Database Schema

```sql
CREATE TABLE daily_reports (
    id BIGINT PRIMARY KEY,
    date DATE UNIQUE NOT NULL,
    
    -- Opening Balances
    cashbox_opening DECIMAL(15,2) NOT NULL,
    bank_opening DECIMAL(15,2) NOT NULL,
    
    -- Day Totals (calculated on close)
    total_sales DECIMAL(15,2) DEFAULT 0,
    total_collections_cash DECIMAL(15,2) DEFAULT 0,
    total_collections_bank DECIMAL(15,2) DEFAULT 0,
    total_expenses_cash DECIMAL(15,2) DEFAULT 0,
    total_expenses_bank DECIMAL(15,2) DEFAULT 0,
    
    -- Closing Balances
    cashbox_closing DECIMAL(15,2),
    bank_closing DECIMAL(15,2),
    
    -- Status
    status ENUM('open', 'closed') DEFAULT 'open',
    closed_at TIMESTAMP NULL,
    closed_by BIGINT NULL
);
```

---

## ğŸ“ Files

| File | Purpose |
|------|---------|
| `Models/DailyReport.php` | Model |
| `Services/DailyReportService.php` | Business Logic + Session |
| `Http/Controllers/Api/DailyReportController.php` | API |
| `Http/Middleware/EnsureWorkingDay.php` | Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙØªØ­ ÙŠÙˆÙ…ÙŠØ© |
